<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Salesforce Account Alias Mapper</title>

  <!-- Carbon Design System -->
  <link rel="stylesheet" href="https://unpkg.com/carbon-components/css/carbon-components.min.css" />
  <script src="https://unpkg.com/carbon-components/scripts/carbon-components.min.js" defer></script>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body class="bx--body">

  <h2 class="bx--type-expressive-heading-04" style="text-align:center; margin:2rem 0; color:#0f62fe;">
    SALESFORCE ACCOUNT ALIAS MAPPER
  </h2>

  <!-- Input Section -->
  <div class="bx--tile input-section" role="region" aria-label="Add account">
    <div class="form-left">
      <div class="bx--form-item full-width">
        <label for="accountInput" class="bx--label">Account Name</label>
        <div id="accountComboBox" class="bx--combo-box combo-box--custom" aria-haspopup="listbox">
          <input id="accountInput" type="text" class="bx--text-input" placeholder="account name" aria-autocomplete="list" />
          <button type="button" class="bx--list-box__menu-icon" aria-label="open menu">
            <svg focusable="false" preserveAspectRatio="xMidYMid meet"
                 xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                 width="30" height="20" viewBox="0 0 32 32">
              <path d="M16 22L6 12l1.4-1.4L16 19.2l8.6-8.6L26 12z"></path>
            </svg>
          </button>
          <ul id="comboMenu" class="bx--list-box__menu" role="listbox" aria-hidden="true"></ul>
        </div>
      </div>

      <div class="bx--form-item full-width">
        <label for="salesforce_name" class="bx--label">Salesforce Account Name</label>
        <input
          id="salesforce_name"
          type="text"
          class="bx--text-input"
          placeholder="Enter Salesforce Account Name"
          style="width: 350px;"
        />
      </div>

      <div style="margin-top: 8px;">
        <button class="bx--btn bx--btn--primary" onclick="addUser()">Add</button>
      </div>
    </div>
  </div>

  <!-- Table Section -->
  <div class="bx--tile table-section">
    <section class="bx--data-table-container" aria-label="Account mappings">
      <table id="users_table" class="bx--data-table bx--data-table--zebra bx--data-table--sort" role="table">
        <thead class="bx--data-table-header">
          <tr role="row">
            <!-- Sortable Account Name column -->
            <th role="columnheader" scope="col" style="width:45%" class="bx--table-sort" aria-sort="none" data-column="account">
              <button class="bx--table-sort__button" type="button" aria-label="Sort by Account Name">
                <span class="bx--table-header-label">ACCOUNT NAME</span>
                <svg focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="16" height="16" viewBox="0 0 32 32" aria-hidden="true" class="bx--table-sort__icon">
                  <path d="M16 22L6 12l1.4-1.4L16 19.2l8.6-8.6L26 12z"></path>
                </svg>
              </button>
            </th>

            <th role="columnheader" scope="col" style="width:38%" class="bx--table-header-label">SALESFORCE ACCOUNT NAME</th>
            <th role="columnheader" scope="col" style="width:17%; text-align:center;" class="bx--table-header-label">ACTIONS</th>
          </tr>
        </thead>
        <tbody role="rowgroup"></tbody>
      </table>
    </section>
  </div>

  <script>
    // Carbon-compliant sorting for Account Name column with proper aria updates
    document.addEventListener("DOMContentLoaded", () => {
      const table = document.getElementById("users_table");
      const tbody = table.querySelector("tbody");
      const sortHeader = table.querySelector('th[data-column="account"]');
      const sortBtn = sortHeader.querySelector('.bx--table-sort__button');
      let ascending = true;

      function updateSortVisual() {
        sortHeader.setAttribute('aria-sort', ascending ? 'ascending' : 'descending');
        // Toggle icon direction class used by Carbon
        sortHeader.classList.toggle('bx--table-sort--ascending', ascending);
        sortHeader.classList.toggle('bx--table-sort--descending', !ascending);
      }

      function sortRows() {
        const rows = Array.from(tbody.querySelectorAll('tr'));
        rows.sort((a, b) => {
          const aText = (a.cells[1]?.innerText || '').trim().toLowerCase();
          const bText = (b.cells[1]?.innerText || '').trim().toLowerCase();
          return ascending ? aText.localeCompare(bText) : bText.localeCompare(aText);
        });
        rows.forEach(r => tbody.appendChild(r));
      }

      sortBtn.addEventListener('click', () => {
        ascending = !ascending;
        sortRows();
        updateSortVisual();
      });

      // Initialize icon/aria state
      updateSortVisual();
    });
  </script>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
